<form script="table_icons_rangemap.js, tokenlinks.js" stylesheet="table_cell_highlighting.css, table_decorations.css">
  <label>Performance Dashboard</label>
  <description>Test Dashboard - NO JavaScript, XML Modified</description>
  <fieldset autoRun="true" submitButton="false">
    <input type="time" token="time" searchWhenChanged="true">
      <label>Set Time</label>
      <default>
        <earliest>-60m@m</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="field1" searchWhenChanged="true">
      <label>APIKey/ Body</label>
      <choice value="">All</choice>
      <choice value="| where component_name=&quot;HMRC&quot;">HMRC</choice>
      <choice value="| where component_name=&quot;Crown&quot;">Crown Commercial</choice>
      <choice value="| where component_name=&quot;Welsh&quot;">Welsh Assembly</choice>
      <choice value="| where component_name=&quot;Company&quot;">Company House</choice>
      <fieldForLabel>Label</fieldForLabel>
      <fieldForValue>Value</fieldForValue>
      <default>| where component_name="HMRC"</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>System Uptime</title>
      <single>
        <search>
          <query>index="allrequests"| stats first(uptime) as Uptime</query>
          <earliest>0</earliest>
          <latest></latest>
          <refresh>30s</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="height">132</option>
        <option name="rangeColors">["0x65a637","0xd93f3c"]</option>
        <option name="rangeValues">[100000]</option>
        <option name="showSparkline">0</option>
        <option name="showTrendIndicator">0</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unit">mins</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Total Calls</title>
      <single>
        <search>
          <query>index = "allrequests" | stats count as "Total API Requests"</query>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">all</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xf58f39","0xd93f3c"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="underLabel">Total API Requests (Stored)</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <title>Real Time Number of Calls</title>
      <single>
        <search>
          <query>index = "allrequests" | timechart count as "Total API Requests" span=1d | fillnull value=NULL</query>
          <earliest>0</earliest>
        </search>
        <!--threshold - if over 25% or at -20% flagged as red-->
        <!--percentage in comparison to yesterday request volume - absolute actual figure-->
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="drilldown">all</option>
        <option name="height">143</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0xd93f3c","0xf7bc38","0xd93f3c"]</option>
        <option name="rangeValues">[-20,25]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">percent</option>
        <option name="trendInterval">-1d</option>
        <option name="underLabel">Compared to Yesterday</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <title>Total Index Size</title>
      <single>
        <search>
          <query>| rest splunk_server=MacBook-Pro.local /services/data/indexes
  | join title type=outer [
  | rest splunk_server=MacBook-Pro.local /services/data/indexes-extended
  | eval cold_bucket_size = if(isnotnull('bucket_dirs.cold.bucket_size'), 'bucket_dirs.cold.bucket_size', 'bucket_dirs.cold.size')
  | fields title, cold_bucket_size, total_size, total_bucket_count]
| fields title maxTotalDataSizeMB currentDBSizeMB frozenTimePeriodInSecs minTime coldPath.maxDataSizeMB homePath.maxDataSizeMB, homePath, coldPath, cold_bucket_size, total_size, total_bucket_count, totalEventCount
| eval currentDBSizeGB = if(isnotnull(currentDBSizeMB), round(currentDBSizeMB / 1024, 2), 0)
| eval maxTotalDataSizeGB = if((maxTotalDataSizeMB == 0) OR isnull(maxTotalDataSizeMB), "unlimited", round(maxTotalDataSizeMB / 1024, 2))
| eval disk_usage_gb = currentDBSizeGB." / ".maxTotalDataSizeGB
| eval currentTimePeriodDay = round((now() - strptime(minTime,"%Y-%m-%dT%H:%M:%S%z")) / 86400, 0)
| eval currentTimePeriodDay = if(isnull(currentTimePeriodDay), 0, currentTimePeriodDay)
| eval frozenTimePeriodDay = round(frozenTimePeriodInSecs / 86400, 0)
| eval frozenTimePeriodDay = if(isnull(frozenTimePeriodDay) OR frozenTimePeriodDay == 0, "unlimited", frozenTimePeriodDay)
| eval freeze_period_viz = currentTimePeriodDay." / ".frozenTimePeriodDay
| eval total_bucket_count = if(isnotnull(total_bucket_count), total_bucket_count, 0)
| eval totalEventCount = if(isnotnull(totalEventCount), totalEventCount, 0)
| eval home_bucket_size_gb = round((total_size - if(isnull(cold_bucket_size), 0, cold_bucket_size)) / 1024, 2)
| eval home_bucket_size_gb = if(isnull(home_bucket_size_gb), 0, home_bucket_size_gb)
| eval home_bucket_capacity_gb = if(isnull('homePath.maxDataSizeMB') OR 'homePath.maxDataSizeMB' = 0, "unlimited", round('homePath.maxDataSizeMB' / 1024, 2))
| eval home_bucket_usage_gb = home_bucket_size_gb." / ".home_bucket_capacity_gb
| eval cold_bucket_size_gb = if(isnull(cold_bucket_size), 0, round(cold_bucket_size / 1024, 2))
| eval cold_bucket_capacity_gb = if(isnull('coldPath.maxDataSizeMB') OR 'coldPath.maxDataSizeMB' = 0, "unlimited", round('coldPath.maxDataSizeMB' / 1024, 2))
| eval cold_bucket_usage_gb = cold_bucket_size_gb." / ".cold_bucket_capacity_gb
| fields title, freeze_period_viz, disk_usage_gb, home_bucket_usage_gb, cold_bucket_usage_gb, total_bucket_count, totalEventCount, currentDBSizeGB,
      cold_bucket_size_gb, home_bucket_size_gb, homePath, coldPath | stats sum(currentDBSizeGB) as total_gb
            | eval total_gb = case(
                total_gb &gt; 1000, round(total_gb / 1024, 2)." TB",
                1 = 1, total_gb." GB"
              )</query>
          <earliest>1482310920</earliest>
          <latest>1482311040</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">all</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xf58f39","0xd93f3c"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="underLabel">Total Index Size (inc.allrequests)</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>API Requests</title>
      <input type="link" token="needed">
        <label>Choose a view type:</label>
        <choice value="link4444">Seperated</choice>
        <choice value="link5555">Overview</choice>
        <default>Table</default>
        <change>
          <condition value="link4444">
            <set token="showInternal29">true</set>
            <unset token="showSplunkd29"></unset>
          </condition>
          <condition value="link5555">
            <unset token="showInternal29"></unset>
            <set token="showSplunkd29">true</set>
          </condition>
        </change>
      </input>
      <input type="radio" token="predict_switch" searchWhenChanged="true" depends="$showSplunkd29$">
        <label>Predict Toggle:</label>
        <default>Off</default>
        <choice value="eventstats avg(&quot;Total API Requests&quot;) as Average">Off</choice>
        <choice value="predict &quot;Total API Requests&quot; future_timespan=30 holdback=1 ">On</choice>
      </input>
      <chart depends="$showSplunkd29$">
        <title>Overall API Requests (trend line shows average-&gt; global set)</title>
        <search>
          <query>index = "allrequests" | timechart count as "Total API Requests" | $predict_switch$</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="charting.axisTitleX.text">Date</option>
        <option name="charting.axisTitleY.text">Total Number of Queries</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.overlayFields">Average</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.fieldColors">{"Total API Requests": 0x2B9954, "Average":0xDC143C}</option>
        <option name="charting.legend.masterLegend">null</option>
        <option name="height">300</option>
      </chart>
      <chart depends="$showInternal29$">
        <title>Total Number of API calls per key</title>
        <search>
          <query>index = "allrequests" | timechart count as "Number of Queries" by component_name</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisTitleX.text">Date and Time</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.text">Number of Queries</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.rangeValues">[]</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>

      </chart>
      <html depends="$showInternal29$">
                <button class="btn" data-set-token="show_overview" data-value="show">Show Overview</button>
            </html>
    </panel>
    <panel depends="$show_overview$">
      <chart>
        <title>Volume of Call per Key</title>
        <search>
          <query>index = "allrequests" | stats count as "Total API Requests" by component_name</query>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisEnd</option>
        <option name="charting.legend.placement">right</option>
        <option name="height">343</option>
      </chart>
      <html depends="$show_overview$">
          <button class="btn" data-unset-token="show_overview">Hide Details</button>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>API Requests Errors and Successes</title>
      <chart>
        <title>Total Successful and Failed API Calls</title>
        <search>
          <query>index = "allrequests" | timechart count as "Number of Queries" by success_flag</query>
          <earliest>@w1</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.text">Date</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.text">Total successful or Failed Requests</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="height">311</option>
      </chart>
      <html>
                <button class="btn" data-set-token="show_details" data-value="show">Show Details</button>
            </html>
    </panel>
    <panel depends="$show_details$">
      <table>
        <title>Results of API Requests Statuses</title>
        <search>
          <query>index = "allrequests" | stats count(success_flag) as "Number of Successes or Failures" by component_name, success_flag</query>
          <earliest>@d</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
      <html>
                <button class="btn" data-unset-token="show_details">Hide Details</button>
            </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>API Request Types</title>
      <input type="link" token="needed">
        <label>Choose a view type:</label>
        <choice value="link44">Ovewview</choice>
        <choice value="link55">Over Time</choice>
        <default>Table</default>
        <change>
          <condition value="link44">
            <set token="showInternal2">true</set>
            <unset token="showSplunkd2"></unset>
          </condition>
          <condition value="link55">
            <unset token="showInternal2"></unset>
            <set token="showSplunkd2">true</set>
          </condition>
        </change>
      </input>
      <chart depends="$showInternal2$">
        <title>Total Request Type</title>
        <search>
          <query>index = "allrequests" | stats count as "Total API Requests" by query_type $field1$</query>
          <earliest>@d</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
      <chart depends="$showSplunkd2$">
        <title>Request Type Over time (This Week)</title>
        <search>
          <query>index = "allrequests" | timechart count as "Number of Queries" by query_type</query>
          <earliest>@w0</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisTitleX.text">Date (week)</option>
        <option name="charting.axisTitleY.text">Volume</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.showDataLabels">none</option>
      </chart>
    </panel>
    <panel>
      <title>Data Used on Licence</title>
      <chart>
        <title>Used v Quota</title>
        <search>
          <query>| rest splunk_server=MacBook-Pro.local /services/licenser/pools | rename title AS Pool | search [rest splunk_server=MacBook-Pro.local /services/licenser/groups | search is_active=1 | eval stack_id=stack_ids | fields stack_id] | eval quota=if(isnull(effective_quota),quota,effective_quota) | eval "Used"=round(used_bytes/quota*100,2)| eval "Quota"=round(quota/1024/1024/1024, 3) | fields Pool "Used" "Quota"</query>
          <earliest>@d</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.text">Data Volume  (GBs)</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisEnd</option>
        <option name="charting.legend.placement">right</option>
        <option name="height">319</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>System Response Time Analysis Table</title>
      <input type="link" token="needed">
        <label>Choose a view type:</label>
        <choice value="link_single">Single</choice>
        <choice value="link_bulk">Bulk</choice>
        <choice value="link_ingress">Ingress</choice>
        <default>Table</default>
        <change>
          <condition value="link_single">
            <set token="showInternal22">true</set>
            <unset token="showSplunkd22"></unset>
            <unset token="showSplunkd32">true</unset>
          </condition>
          <condition value="link_bulk">
            <unset token="showInternal22"></unset>
            <unset token="showSplunkd32">true</unset>
            <set token="showSplunkd22">true</set>
          </condition>
          <condition value="link_ingress">
            <unset token="showInternal22"></unset>
            <unset token="showSplunkd22"></unset>
            <set token="showSplunkd32">true</set>
          </condition>
        </change>
      </input>
      <table depends="$showInternal22$">
        <title>Request and Response Time - Single Match</title>
        <search>
          <query>index = "allrequests"
| eval request = strptime(request_time, "%H:%M:%S")
| eval response = strptime(response_time, "%H:%M:%S")
| eval diff = tostring( (response - request), "duration") | eval Difference = replace(diff,"(\d+)\:(\d+)\:(\d+)"," \3") | where query_type = "single" $field1$
| table query_id, request_time, response_time, Difference</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="Difference">
          <colorPalette type="list">[#FFFFFF,#F7BC38,#DC143C]</colorPalette>
          <scale type="threshold">2,4</scale>
        </format>
      </table>
      <table depends="$showSplunkd22$">
        <title>Request and Response Time - Bulk Match</title>
        <search>
          <query>index = "allrequests"
| eval request = strptime(request_time, "%H:%M:%S")
| eval response = strptime(response_time, "%H:%M:%S")
| eval diff = tostring( (response - request), "duration") | eval Difference = replace(diff,"(\d+)\:(\d+)\:(\d+)"," \3") | where query_type = "bulk" $field1$
| table query_id, request_time, response_time, Difference</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="Difference">
          <colorPalette type="list">[#FFFFFF,#F7BC38,#D93F3C]</colorPalette>
          <scale type="threshold">3,4</scale>
        </format>
      </table>
      <table id="table2" depends="$showSplunkd32$">
        <title>Ingess Start Time and End Ingress Time</title>
        <search>
          <query>index = "allrequests"
              | eval request = strptime(request_time, "%H:%M:%S")
              | eval response = strptime(response_time, "%H:%M:%S")
              | eval diff = tostring( (response - request), "duration") | eval Difference = replace(diff,"(\d+)\:(\d+)\:(\d+)"," \3") | where query_type = "single" $field1$
              | table query_id, request_time, response_time, Difference, success_flag
              | rename "query_id" as "Query ID", "request_time" as "Start Time", "response_time" as "End time", "success_flag" as "Success Flag"</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="success_flag">
          <colorPalette type="map">{"Fail":#D8451C,"Success":#65A637}</colorPalette>
        </format>
        <format type="color" field="Difference">
          <colorPalette type="list">[#FFFFFF,#F7BC38,#D8451C]</colorPalette>
          <scale type="threshold">2,4</scale>
        </format>
        <format type="color" field="Success Flag">
          <colorPalette type="map">{"Success":#65A637,"Fail":#D93F3C}</colorPalette>
        </format>
      </table>
    </panel>
    <panel>
      <title>Data Volume and Component Availability</title>
      <input type="link" token="needed">
        <label>Choose a view type:</label>
        <choice value="link4">Table</choice>
        <choice value="link5">Graph</choice>
        <default>Table</default>
        <change>
          <condition value="link4">
            <set token="showInternal">true</set>
            <unset token="showSplunkd"></unset>
          </condition>
          <condition value="link5">
            <unset token="showInternal"></unset>
            <set token="showSplunkd">true</set>
          </condition>
        </change>
      </input>
      <table depends="$showInternal$">
        <title>Data Record Request From Users (Today)</title>
        <search>
          <query>index = "allrequests" |   stats sparkline count, sum(data_returned) by component_name | sort -sum(data_returned)</query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
      </table>
      <!--<html>            -->
      <!--   <a href="/app/search/appserver/static/system_component"><h3>System Component</h3></a>-->
      <!-- </html>-->
      <table id="table1" depends="$showInternal$">
        <title>System Component Status (Real - Time)</title>
        <search>
          <query>index="allrequests" | head 1|  stats sum(hdfs_status) as "HDFS Status", sum(elastic_search_status) as "Elasticsearch Status", sum(flume_status) as "Flume Status", sum(spark_status) as "Spark Status" | table "Flume Status", "HDFS Status", "Elasticsearch Status", "Spark Status" | transpose | rename "column" as "Component Type", "row 1" as "Current Score"| rangemap field="Current Score" low=0.1-1 elevated=1.1-2 severe=2.1-3 default=none</query>
          <earliest>rt</earliest>
          <latest>rt</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <drilldown>
          <link>
            system_component
            </link>
          </drilldown>
      </table>
      <chart depends="$showSplunkd$">
        <title>Graph of Data Record Request From Users (This Week)</title>
        <search>
          <query>index = "allrequests" | timechart sum(data_returned) by component_name</query>
          <earliest>-7d@w0</earliest>
          <latest>@w0</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-90</option>
        <option name="charting.axisTitleX.text">Date</option>
        <option name="charting.axisTitleY.text">Number of Records</option>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="height">461</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Recent API Calls</title>
      <table>
        <search>
          <query>index = "allrequests" | table query_id, request_time, response_time, number_of_queries, component_name, success_flag $field1$ | head 10</query>
          <earliest>0</earliest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="success_flag">
          <colorPalette type="list">[#65A637,#6DB7C6,#F7BC38,#F58F39,#D93F3C]</colorPalette>
          <scale type="threshold">0,30,70,100</scale>
        </format>
      </table>
    </panel>
  </row>
</form>
